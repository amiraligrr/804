<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ú†Øª Ø¢Ù†Ù„Ø§ÛŒÙ† Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</title>
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: 'Vazirmatn', sans-serif; background-color: #121212; color: white; text-align: center; }
        .chat-container { max-width: 400px; margin: 20px auto; background: #1e1e1e; padding: 15px; border-radius: 10px; box-shadow: 0px 0px 10px rgba(255, 255, 255, 0.2); }
        .chat-box { height: 300px; overflow-y: auto; padding: 10px; border-radius: 5px; background: #252525; }
        .message { margin: 10px 0; padding: 8px; border-radius: 8px; text-align: left; background: #333; }
        .message .username { font-weight: bold; color: #ff9800; }
        .input-container { display: flex; gap: 5px; margin-top: 10px; }
        input { flex: 1; padding: 10px; border-radius: 5px; border: none; background: #333; color: white; }
        button { padding: 10px; border: none; border-radius: 5px; background: #ff9800; color: white; cursor: pointer; }
        button:hover { background: #e68900; }
        .reply { font-size: 0.8em; color: #bbb; }
    </style>
</head>
<body>
    <div class="chat-container">
        <h2>ğŸ’¬ Ú†Øª Ø¢Ù†Ù„Ø§ÛŒÙ†</h2>
        <div id="chat-box" class="chat-box"></div>
        <div class="input-container">
            <input type="text" id="input-box" placeholder="Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯...">
            <button onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <script>
        // Ø¯Ø±ÛŒØ§ÙØª Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø§Ø² ØµÙØ­Ù‡ Ù‚Ø¨Ù„ÛŒ
        var studentNames = [
            "Ù…Ø­Ù…Ø¯ Ø¶ÛŒØ§ Ø§Ù„Ø¯ÛŒÙ†ÛŒ", "Ø­Ø³Ù† Ø·Ù‡Ù…ÙˆØ±Ø³ÛŒ", "Ø¹Ù„ÛŒ Ø¹Ø±Ø¨ Ù†Ø²Ø§Ø¯", "Ø§Ø±Ø´ÛŒØ§ Ø¹Ø²ÛŒØ² Ø²Ø§Ø¯Ù‡", "Ø¨Ø±Ø¯ÛŒØ§ Ø¹Ø³Ú©Ø±ÛŒØ§Ù†",
            "Ù…Ø­Ù…Ø¯Ù…Ù‡Ø¯ÛŒ Ø¹Ù„ÛŒØ²Ø§Ø¯Ù‡", "Ø­Ø³Ù† ÙØ¯Ø§ÛŒÛŒ", "Ø³Ù¾Ù‡Ø± ÙÚ©ÙˆØ±ÛŒ", "Ø§Ù…ÛŒØ±Ø¹Ù„ÛŒ Ù‚Ø±Ø§ÛŒÛŒ", "Ø­Ø³ÛŒÙ† Ù‚Ø±Ø¨Ø§Ù†ÛŒ",
            "Ø§Ù…ÛŒØ±Ø¹Ø¨Ø§Ø³ Ù‚Ø·Ø¨ÛŒ", "Ù¾Ø§Ø±Ø³Ø§ Ù‚Ù†Ø¨Ø±ÛŒ", "Ú©ÛŒØ§Ù† Ú©Ø§Ø±Ø§Ù…ÙˆØ²ÛŒØ§Ù†", "Ø§Ø¨ÙˆØ§Ù„ÙØ¶Ù„ Ú©Ø§Ø±Ú¯Ø±", "Ø§Ø¨ØªÛŒÙ† Ú©Ø§Ø¸Ù…ÛŒ",
            "Ø¹Ú©ÛŒ Ú©Ø±ÙˆÚ©ÛŒ", "Ø¹Ù„ÛŒØ±Ø¶Ø§ Ú©Ø±ÛŒÙ…ÛŒ", "Ø±Ø§Ø¯ÛŒÙ† Ú©ÙˆØ´Ø´", "Ù…Ø­Ù…Ø¯ Ù…Ù‡Ø¯ÛŒ Ú©Ù‡Ù†Ø¯Ù„", "Ø§Ù…ÛŒØ±Ø¹Ù„ÛŒ Ú¯Ø±Ø§Ù†Ù…Ø§ÛŒÙ‡",
            "Ù…Ù‡Ø±Ø§Ø¯ Ú¯Ø±Ú¯Ø§Ù†ÛŒ", "Ø§Ø±Ø´Ø§Ù… Ù„Ø§Ø±ÛŒ", "Ø§Ù…ÛŒÙ† Ù…Ø§Ù„Ú©ÛŒ", "Ø±Ø§Ø¯ÛŒÙ† Ù…Ø­Ø³Ù†ÛŒ", "Ù…ØªÛŒÙ† Ù…Ø­Ù…Ø¯ÛŒ", "Ø³Ø§Ù… Ù…Ø­Ù…ÙˆØ¯ÛŒ"
        ];
    
        var studentNumber = localStorage.getItem('studentNumber');
        var username = studentNames[studentNumber - 1] || "Ú©Ø§Ø±Ø¨Ø± Ù†Ø§Ø´Ù†Ø§Ø³";
        localStorage.setItem('chatUsername', username);
        
        const socket = io("http://localhost:3000", { query: { username } });

        const badWords = ["Ú©Ù„Ù…Ù‡1", "Ú©Ù„Ù…Ù‡2", "Ø³Ù„Ø§Ù…"]; // Ù„ÛŒØ³Øª Ú©Ù„Ù…Ø§Øª ÙÛŒÙ„ØªØ± Ø´Ø¯Ù‡
        const admins = ["Admin1", "Admin2"]; // Ù„ÛŒØ³Øª Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§
        let mutedUsers = {};

        function sendMessage(replyTo = null) {
            const input = document.getElementById("input-box");
            let msg = input.value.trim();
            if (!msg) return;

            socket.emit("message", { username, msg: replyTo ? `@${replyTo}: ${msg}` : msg });
            input.value = "";
        }

        socket.on("message", ({ username, msg }) => {
            const chatBox = document.getElementById("chat-box");
            const messageElem = document.createElement("div");
            messageElem.classList.add("message");
            
            let replyMatch = msg.match(/^@(\w+): (.*)/);
            if (replyMatch) {
                messageElem.innerHTML = `<span class="reply">Ù¾Ø§Ø³Ø® Ø¨Ù‡ ${replyMatch[1]}:</span> `;
                msg = replyMatch[2];
            }

            messageElem.innerHTML += `<span class="username">${username}:</span> ${msg}`;
            chatBox.appendChild(messageElem);
            chatBox.scrollTop = chatBox.scrollHeight;
        });
    </script>
</body>
</html>
